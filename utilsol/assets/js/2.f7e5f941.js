(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{255:function(e,t,i){"use strict";i.r(t),i.d(t,"EShapeFile",(function(){return Rt})),i.d(t,"animation",(function(){return It})),i.d(t,"interaction",(function(){return Mt})),i.d(t,"plot",(function(){return ke})),i.d(t,"style",(function(){return Lt})),i.d(t,"utils",(function(){return rt}));var n,r=i(245),s=i(311),o=i(309),a=i(260),l=i(250),h=i(261),u=i(274),c=i(262),d=i(276),f=i(263),_=i(308),p=i(304),g=i(253),b=i(252),y=i(298),m=i(296),P=i(300),v=i(418),w=i(419),O=i(248),A=i(272),F=i(249),C=i(420),S=i(273),I=i(435),T=i(241),j=i(393),M=i.n(j),L=i(291),E=i(394),H=i(288),x=i(399),R=i(412),N=i(413),D=i.n(N);!function(e){e.ARC="arc",e.ASSAULT_DIRECTION="assaultdirection",e.ATTACK_ARROW="attackarrow",e.CIRCLE="circle",e.CLOSED_CURVE="closedcurve",e.CURVE="curve",e.DIAMOND="diamond",e.DOUBLE_ARROW="doublearrow",e.ELLIPSE="ellipse",e.FINE_ARROW="finearrow",e.FREEHAND_LINE="freehandline",e.FREEHAND_POLYGON="freehandpolygon",e.GATHERING_PLACE="gatheringplace",e.LUNE="lune",e.POINT="point",e.POLYLINE="polyline",e.POLYGON="polygon",e.RECTANGLE="rectangle",e.SECTOR="sector",e.SQUAD_COMBAT="squadcombat",e.STRAIGHT_ARROW="straightarrow",e.TAILED_ATTACK_ARROW="tailedattackarrow",e.TAILED_SQUAD_COMBAT="tailedsquadcombat",e.TRIANGLE="triangle",e.REGULARPOLYGON="regularpolygon",e.STAR="star"}(n||(n={}));var G=n;const W={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4};function k(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function U(e){let t=0;for(var i=0;i<e.length-1;i++)t+=k(e[i],e[i+1]);return t}function K(e){return Math.pow(U(e),.99)}function B(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function V(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],r=[n[0]-e[1]+t[1],n[1]+e[0]-t[0]],s=[(e[0]+i[0])/2,(e[1]+i[1])/2];return function(e,t,i,n){if(e[1]==t[1]){var r=(n[0]-i[0])/(n[1]-i[1]),s=r*(e[1]-i[1])+i[0],o=e[1];return[s,o]}if(i[1]==n[1]){var a=(t[0]-e[0])/(t[1]-e[1]);return s=a*(i[1]-e[1])+e[0],o=i[1],[s,o]}return a=(t[0]-e[0])/(t[1]-e[1]),r=(n[0]-i[0])/(n[1]-i[1]),o=(a*e[1]-e[0]-r*i[1]+i[0])/(a-r),[s=a*o-a*e[1]+e[0],o]}(n,r,s,[s[0]-e[1]+i[1],s[1]+e[0]-i[0]])}function Y(e,t){var i,n=Math.asin(Math.abs(t[1]-e[1])/k(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=n+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=W.TWO_PI-n:t[1]<e[1]&&t[0]<e[0]?i=n:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-n),i}function z(e,t,i){var n=Y(t,e)-Y(t,i);return n<0?n+W.TWO_PI:n}function q(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}function Z(e,t,i,n,r){var s=1-(e=Math.max(Math.min(e,1),0)),o=e*e,a=o*e,l=s*s,h=l*s;return[h*t[0]+3*l*e*i[0]+3*s*o*n[0]+a*r[0],h*t[1]+3*l*e*i[1]+3*s*o*n[1]+a*r[1]]}function J(e,t,i,n,r=!0){var s=Y(e,t),o=r?s+i:s-i,a=n*Math.cos(o),l=n*Math.sin(o);return[t[0]+a,t[1]+l]}function Q(e,t,i,n){var r,s,o=[],a=n-i;a=a<0?a+W.TWO_PI:a;for(var l=0;l<=W.FITTING_COUNT;l++){var h=i+a*l/W.FITTING_COUNT;r=e[0]+t*Math.cos(h),s=e[1]+t*Math.sin(h),o.push([r,s])}return o}function X(e,t,i,n){var r=$(t,i,n),s=Math.sqrt(r[0]*r[0]+r[1]*r[1]),o=r[0]/s,a=r[1]/s,l=k(t,i),h=k(i,n);if(s>W.ZERO_TOLERANCE)if(q(t,i,n)){var u=e*l,c=i[0]-u*a,d=i[1]+u*o,f=[c,d];u=e*h;var _=[c=i[0]+u*a,d=i[1]-u*o]}else u=e*l,f=[c=i[0]+u*a,d=i[1]-u*o],u=e*h,_=[c=i[0]-u*a,d=i[1]+u*o];else f=[c=i[0]+e*(t[0]-i[0]),d=i[1]+e*(t[1]-i[1])],_=[c=i[0]+e*(n[0]-i[0]),d=i[1]+e*(n[1]-i[1])];return[f,_]}function $(e,t,i){var n=e[0]-t[0],r=e[1]-t[1],s=Math.sqrt(n*n+r*r);n/=s,r/=s;var o=i[0]-t[0],a=i[1]-t[1],l=Math.sqrt(o*o+a*a);return[n+(o/=l),r+(a/=l)]}function ee(e,t){for(var i=[function(e,t=1){var i=e[0],n=e[1],r=e[2],s=X(0,i,n,r)[0],o=$(i,n,r);if(Math.sqrt(o[0]*o[0]+o[1]*o[1])>W.ZERO_TOLERANCE)var a=B(i,n),l=i[0]-a[0],h=i[1]-a[1],u=2/k(i,n),c=-u*h,d=u*l,f=c*c-d*d,_=2*c*d,p=d*d-c*c,g=s[0]-a[0],b=s[1]-a[1],y=a[0]+f*g+_*b,m=a[1]+_*g+p*b;else y=i[0]+t*(n[0]-i[0]),m=i[1]+t*(n[1]-i[1]);return[y,m]}(t)],n=0;n<t.length-2;n++){var r=X(e,t[n],t[n+1],t[n+2]);i=i.concat(r)}var s=function(e,t=1){var i=e.length,n=e[i-3],r=e[i-2],s=e[i-1],o=X(0,n,r,s)[1],a=$(n,r,s);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>W.ZERO_TOLERANCE)var l=B(r,s),h=s[0]-l[0],u=s[1]-l[1],c=2/k(r,s),d=-c*u,f=c*h,_=d*d-f*f,p=2*d*f,g=f*f-d*d,b=o[0]-l[0],y=o[1]-l[1],m=l[0]+_*b+p*y,P=l[1]+p*b+g*y;else m=s[0]+t*(r[0]-s[0]),P=s[1]+t*(r[1]-s[1]);return[m,P]}(t);i.push(s);var o=[];for(n=0;n<t.length-1;n++){let e=t[n],r=t[n+1];o.push(e);for(let t=0;t<W.FITTING_COUNT;t++){var a=Z(t/W.FITTING_COUNT,e,i[2*n],i[2*n+1],r);o.push(a)}o.push(r)}return o}function te(e){if(e.length<=2)return e;let t=[],i=e.length-1;for(var n=0;n<=1;n+=.01){for(var r=0,s=0,o=0;o<=i;o++){var a=ie(i,o),l=Math.pow(n,o),h=Math.pow(1-n,i-o);r+=a*l*h*e[o][0],s+=a*l*h*e[o][1]}t.push([r,s])}return t.push(e[i]),t}function ie(e,t){return ne(e)/(ne(t)*ne(e-t))}function ne(e){if(e<=1)return 1;if(2==e)return 2;if(3==e)return 6;if(4==e)return 24;if(5==e)return 120;for(var t=1,i=1;i<=e;i++)t*=i;return t}function re(e){if(e.length<=2)return e;let t=[],i=e.length-2-1;t.push(e[0]);for(var n=0;n<=i;n++)for(var r=0;r<=1;r+=.05){for(var s=0,o=0,a=0;a<=2;a++){var l=se(a,r);s+=l*e[n+a][0],o+=l*e[n+a][1]}t.push([s,o])}return t.push(e[e.length-1]),t}function se(e,t){return 0==e?Math.pow(t-1,2)/2:1==e?(-2*Math.pow(t,2)+2*t+1)/2:2==e?Math.pow(t,2)/2:0}class oe extends y.default{constructor(e){super([]),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fixPointCount",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"points",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.type=G.POLYLINE,this.setPoints(e)}generate(){this.getPointCount()<2||this.setCoordinates(this.points)}isPlot(){return!0}setPoints(e){this.points=e||[],this.points.length>=1&&this.generate()}getPoints(){return this.points.slice(0)}getPointCount(){return this.points.length}updatePoint(e,t){t>=0&&t<this.points.length&&(this.points[t]=e,this.generate())}updateLastPoint(e){this.updatePoint(e,this.points.length-1)}finishDrawing(){}}class ae extends oe{constructor(e){super([]),this.type=G.ARC,this.fixPointCount=3,this.setPoints(e)}generate(){var e=this.getPointCount();if(!(e<2))if(2==e)this.setCoordinates(this.points);else{var t=this.points[0],i=this.points[1],n=this.points[2],r=V(t,i,n),s=k(t,r),o=Y(t,r),a=Y(i,r);if(q(t,i,n))var l=a,h=o;else l=o,h=a;this.setCoordinates(Q(r,s,l,h))}}}class le extends m.a{constructor(e){super([]),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fixPointCount",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"points",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.type=G.POLYGON,this.setPoints(e)}generate(){this.getPointCount()<2||this.setCoordinates([this.points])}isPlot(){return!0}setPoints(e){this.points=e||[],this.points.length>=1&&this.generate()}getPoints(){return this.points.slice(0)}getPointCount(){return this.points.length}updatePoint(e,t){t>=0&&t<this.points.length&&(this.points[t]=e,this.generate())}updateLastPoint(e){this.updatePoint(e,this.points.length-1)}finishDrawing(){}}class he extends le{constructor(e){super([]),Object.defineProperty(this,"tailWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.FINE_ARROW,this.tailWidthFactor=.15,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.fixPointCount=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.getPoints(),t=e[0],i=e[1],n=K(e),r=n*this.tailWidthFactor,s=n*this.neckWidthFactor,o=n*this.headWidthFactor,a=J(i,t,W.HALF_PI,r,!0),l=J(i,t,W.HALF_PI,r,!1),h=J(t,i,this.headAngle,o,!1),u=J(t,i,this.headAngle,o,!0),c=[a,J(t,i,this.neckAngle,s,!1),h,i,u,J(t,i,this.neckAngle,s,!0),l];this.setCoordinates([c])}}}class ue extends he{constructor(e){super([]),this.type=G.ASSAULT_DIRECTION,this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI,this.setPoints(e)}}class ce extends le{constructor(e){super([]),Object.defineProperty(this,"headHeightFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckHeightFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headTailFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8,this.setPoints(e)}generate(){if(!(this.getPointCount()<2))if(2!=this.getPointCount()){var e=this.getPoints(),t=e[0],i=e[1];q(e[0],e[1],e[2])&&(t=e[1],i=e[0]);var n=[B(t,i)].concat(e.slice(2)),r=this.getArrowHeadPoints(n,t,i),s=r[0],o=r[4],a=k(t,i)/K(n),l=this.getArrowBodyPoints(n,s,o,a),h=l.length,u=[t].concat(l.slice(0,h/2));u.push(s);var c=[i].concat(l.slice(h/2,h));c.push(o),u=re(u),c=re(c),this.setCoordinates([u.concat(r,c.reverse())])}else this.setCoordinates([this.points])}getArrowHeadPoints(e,t,i){var n=K(e),r=n*this.headHeightFactor,s=e[e.length-1];n=k(s,e[e.length-2]);var o=k(t,i);r>o*this.headTailFactor&&(r=o*this.headTailFactor);var a=r*this.headWidthFactor,l=r*this.neckWidthFactor,h=(r=r>n?n:r)*this.neckHeightFactor,u=J(e[e.length-2],s,0,r,!0),c=J(e[e.length-2],s,0,h,!0),d=J(s,u,W.HALF_PI,a,!1),f=J(s,u,W.HALF_PI,a,!0);return[J(s,c,W.HALF_PI,l,!1),d,s,f,J(s,c,W.HALF_PI,l,!0)]}getArrowBodyPoints(e,t,i,n){for(var r=U(e),s=K(e)*n,o=(s-k(t,i))/2,a=0,l=[],h=[],u=1;u<e.length-1;u++){var c=z(e[u-1],e[u],e[u+1])/2,d=(s/2-(a+=k(e[u-1],e[u]))/r*o)/Math.sin(c),f=J(e[u-1],e[u],Math.PI-c,d,!0),_=J(e[u-1],e[u],c,d,!1);l.push(f),h.push(_)}return l.concat(h)}}class de extends le{constructor(e){super([]),this.type=G.CIRCLE,this.fixPointCount=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=k(e,this.points[1]);this.setCoordinates([this.generatePoints(e,t)])}}generatePoints(e,t){for(var i,n,r,s=[],o=0;o<=W.FITTING_COUNT;o++)r=2*Math.PI*o/W.FITTING_COUNT,i=e[0]+t*Math.cos(r),n=e[1]+t*Math.sin(r),s.push([i,n]);return s}}class fe extends le{constructor(e){super([]),Object.defineProperty(this,"t",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.CLOSED_CURVE,this.t=.3,this.setPoints(e)}generate(){if(!((e=this.getPointCount())<2))if(2==e)this.setCoordinates([this.points]);else{var e,t=this.getPoints();t.push(t[0],t[1]);for(var i=[],n=0;n<t.length-2;n++){var r=X(this.t,t[n],t[n+1],t[n+2]);i=i.concat(r)}i=[i[(e=i.length)-1]].concat(i.slice(0,e-1));var s=[];for(n=0;n<t.length-2;n++){var o=t[n],a=t[n+1];s.push(o);for(var l=0;l<=W.FITTING_COUNT;l++){var h=Z(l/W.FITTING_COUNT,o,i[2*n],i[2*n+1],a);s.push(h)}s.push(a)}this.setCoordinates([s])}}}class _e extends oe{constructor(e){super([]),Object.defineProperty(this,"t",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.CURVE,this.t=.3,this.setPoints(e)}generate(){var e=this.getPointCount();e<2||(2==e?this.setCoordinates(this.points):this.setCoordinates(ee(this.t,this.points)))}}class pe extends le{constructor(e){super([]),Object.defineProperty(this,"headHeightFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckHeightFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"neckWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"connPoint",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"tempPoint4",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.type=G.DOUBLE_ARROW,this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.fixPointCount=4,this.setPoints(e)}finishDrawing(){3==this.getPointCount()&&null!=this.tempPoint4&&this.points.push(this.tempPoint4),null!=this.connPoint&&this.points.push(this.connPoint)}generate(){if(!((s=this.getPointCount())<2))if(2!=s){var e,t,i=this.points[0],n=this.points[1],r=this.points[2],s=this.getPointCount();this.tempPoint4=3==s?this.getTempPoint4(i,n,r):this.points[3],this.connPoint=3==s||4==s?B(i,n):this.points[4],q(i,n,r)?(e=this.getArrowPoints(i,this.connPoint,this.tempPoint4,!1),t=this.getArrowPoints(this.connPoint,n,r,!0)):(e=this.getArrowPoints(n,this.connPoint,r,!1),t=this.getArrowPoints(this.connPoint,i,this.tempPoint4,!0));var o=e.length,a=(o-5)/2,l=e.slice(0,a),h=e.slice(a,a+5),u=e.slice(a+5,o),c=t.slice(0,a),d=t.slice(a,a+5),f=t.slice(a+5,o);c=te(c);var _=te(f.concat(l.slice(1)));u=te(u);var p=c.concat(d,_,h,u);this.setCoordinates([p])}else this.setCoordinates([this.points])}getArrowPoints(e,t,i,n){var r=B(e,t),s=k(r,i),o=J(i,r,0,.3*s,!0),a=J(i,r,0,.5*s,!0),l=[r,o=J(r,o,W.HALF_PI,s/5,n),a=J(r,a,W.HALF_PI,s/4,n),i],h=this.getArrowHeadPoints(l),u=h[0],c=h[4],d=k(e,t)/K(l)/2,f=this.getArrowBodyPoints(l,u,c,d),_=f.length,p=f.slice(0,_/2),g=f.slice(_/2,_);return p.push(u),g.push(c),(p=p.reverse()).push(t),(g=g.reverse()).push(e),p.reverse().concat(h,g)}getArrowHeadPoints(e){var t=K(e)*this.headHeightFactor,i=e[e.length-1],n=t*this.headWidthFactor,r=t*this.neckWidthFactor,s=t*this.neckHeightFactor,o=J(e[e.length-2],i,0,t,!0),a=J(e[e.length-2],i,0,s,!0),l=J(i,o,W.HALF_PI,n,!1),h=J(i,o,W.HALF_PI,n,!0);return[J(i,a,W.HALF_PI,r,!1),l,i,h,J(i,a,W.HALF_PI,r,!0)]}getArrowBodyPoints(e,t,i,n){for(var r=U(e),s=K(e)*n,o=(s-k(t,i))/2,a=0,l=[],h=[],u=1;u<e.length-1;u++){var c=z(e[u-1],e[u],e[u+1])/2,d=(s/2-(a+=k(e[u-1],e[u]))/r*o)/Math.sin(c),f=J(e[u-1],e[u],Math.PI-c,d,!0),_=J(e[u-1],e[u],c,d,!1);l.push(f),h.push(_)}return l.concat(h)}getTempPoint4(e,t,i){var n,r,s,o,a=B(e,t),l=k(a,i),h=z(e,a,i);return h<W.HALF_PI?(r=l*Math.sin(h),s=l*Math.cos(h),o=J(e,a,W.HALF_PI,r,!1),n=J(a,o,W.HALF_PI,s,!0)):h>=W.HALF_PI&&h<Math.PI?(r=l*Math.sin(Math.PI-h),s=l*Math.cos(Math.PI-h),o=J(e,a,W.HALF_PI,r,!1),n=J(a,o,W.HALF_PI,s,!1)):h>=Math.PI&&h<1.5*Math.PI?(r=l*Math.sin(h-Math.PI),s=l*Math.cos(h-Math.PI),o=J(e,a,W.HALF_PI,r,!0),n=J(a,o,W.HALF_PI,s,!0)):(r=l*Math.sin(2*Math.PI-h),s=l*Math.cos(2*Math.PI-h),o=J(e,a,W.HALF_PI,r,!0),n=J(a,o,W.HALF_PI,s,!1)),n}}class ge extends le{constructor(e){super([]),this.type=G.ELLIPSE,this.fixPointCount=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=this.points[1],i=B(e,t),n=Math.abs((e[0]-t[0])/2),r=Math.abs((e[1]-t[1])/2);this.setCoordinates([this.generatePoints(i,n,r)])}}generatePoints(e,t,i){for(var n,r,s,o=[],a=0;a<=W.FITTING_COUNT;a++)s=2*Math.PI*a/W.FITTING_COUNT,n=e[0]+t*Math.cos(s),r=e[1]+i*Math.sin(s),o.push([n,r]);return o}}class be extends oe{constructor(e){super([]),Object.defineProperty(this,"freehand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.FREEHAND_LINE,this.freehand=!0,this.setPoints(e)}generate(){this.getPointCount()<2||this.setCoordinates(this.points)}}class ye extends le{constructor(e){super([]),Object.defineProperty(this,"freehand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.FREEHAND_POLYGON,this.freehand=!0,this.setPoints(e)}generate(){this.getPointCount()<2||this.setCoordinates([this.points])}}class me extends le{constructor(e){super([]),Object.defineProperty(this,"t",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.GATHERING_PLACE,this.t=.4,this.fixPointCount=3,this.setPoints(e)}generate(){var e=this.getPoints();if(!(e.length<2)){if(2==this.getPointCount()){var t=B(e[0],e[1]),i=k(e[0],t)/.9,n=J(e[0],t,W.HALF_PI,i,!0);e=[e[0],n,e[1]]}t=B(e[0],e[2]);e.push(t,e[0],e[1]);for(var r=[],s=0;s<e.length-2;s++){var o=e[s],a=e[s+1],l=e[s+2],h=X(this.t,o,a,l);r=r.concat(h)}var u=r.length;r=[r[u-1]].concat(r.slice(0,u-1));var c=[];for(s=0;s<e.length-2;s++){o=e[s],a=e[s+1],c.push(o);for(var d=0;d<=W.FITTING_COUNT;d++){n=Z(d/W.FITTING_COUNT,o,r[2*s],r[2*s+1],a);c.push(n)}c.push(a)}this.setCoordinates([c])}}}class Pe extends le{constructor(e){super([]),this.type=G.LUNE,this.fixPointCount=3,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.getPoints();if(2==this.getPointCount()){var t=B(e[0],e[1]),i=k(e[0],t),n=J(e[0],t,W.HALF_PI,i);e.push(n)}var r=e[0],s=e[1],o=e[2],a=V(r,s,o),l=k(r,a),h=Y(r,a),u=Y(s,a);if(q(r,s,o))var c=u,d=h;else c=h,d=u;(e=Q(a,l,c,d)).push(e[0]),this.setCoordinates([e])}}}class ve extends P.a{constructor(e){super([0,0]),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fixPointCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"points",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.type=G.POINT,this.fixPointCount=1,this.setPoints(e)}generate(){var e=this.points[0];this.setCoordinates(e)}isPlot(){return!0}setPoints(e){this.points=e||[],this.points.length>=1&&this.generate()}getPoints(){return this.points.slice(0)}getPointCount(){return this.points.length}updatePoint(e,t){t>=0&&t<this.points.length&&(this.points[t]=e,this.generate())}updateLastPoint(e){this.updatePoint(e,this.points.length-1)}finishDrawing(){}}class we extends le{constructor(e){super([]),this.type=G.RECTANGLE,this.fixPointCount=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=this.points[1],i=Math.min(e[0],t[0]),n=Math.max(e[0],t[0]),r=Math.min(e[1],t[1]),s=Math.max(e[1],t[1]),o=[i,s],a=[n,s],l=[n,r],h=[i,r];this.setCoordinates([[o,a,l,h]])}}}class Oe extends le{constructor(e){super([]),this.type=G.SECTOR,this.fixPointCount=3,this.setPoints(e)}generate(){if(!(this.getPointCount()<2))if(2==this.getPointCount())this.setCoordinates([this.points]);else{var e=this.getPoints(),t=e[0],i=e[1],n=e[2],r=Q(t,k(i,t),Y(i,t),Y(n,t));r.push(t,r[0]),this.setCoordinates([r])}}}class Ae extends ce{constructor(e){super([]),Object.defineProperty(this,"tailWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.setPoints(e)}generate(){if(!((o=this.getPointCount())<2)){var e=this.getPoints(),t=this.getTailPoints(e),i=this.getArrowHeadPoints(e,t[0],t[1]),n=i[0],r=i[4],s=this.getArrowBodyPoints(e,n,r,this.tailWidthFactor),o=s.length,a=[t[0]].concat(s.slice(0,o/2));a.push(n);var l=[t[t.length-1]].concat(s.slice(o/2,o));l.push(r),a=re(a),l=re(l),this.setCoordinates([a.concat(i,l.reverse(),t.slice(1,t.length-1))])}}getTailPoints(e){var t=K(e)*this.tailWidthFactor;return[J(e[1],e[0],W.HALF_PI,t,!1),J(e[1],e[0],W.HALF_PI,t,!0)]}}class Fe extends oe{constructor(e){super([]),Object.defineProperty(this,"maxArrowLength",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arrowLengthScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arrowAngle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.STRAIGHT_ARROW,this.fixPointCount=2,this.maxArrowLength=3e6,this.arrowLengthScale=5,this.arrowAngle=Math.PI/5,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.getPoints(),t=e[0],i=e[1],n=k(t,i)/this.arrowLengthScale;n=n>this.maxArrowLength?this.maxArrowLength:n;var r=J(t,i,this.arrowAngle,n,!1),s=J(t,i,this.arrowAngle,n,!0);this.setCoordinates([t,i,r,i,s])}}}class Ce extends ce{constructor(e){super([]),Object.defineProperty(this,"tailWidthFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"swallowTailFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"swallowTailPnt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.TAILED_ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(e)}generate(){if(!((d=this.getPointCount())<2))if(2!=this.getPointCount()){var e=this.getPoints(),t=e[0],i=e[1];q(e[0],e[1],e[2])&&(t=e[1],i=e[0]);var n=[B(t,i)].concat(e.slice(2)),r=this.getArrowHeadPoints(n,t,i),s=r[0],o=r[4],a=k(t,i),l=K(n),h=l*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=J(n[1],n[0],0,h,!0);var u=a/l,c=this.getArrowBodyPoints(n,s,o,u),d=c.length,f=[t].concat(c.slice(0,d/2));f.push(s);var _=[i].concat(c.slice(d/2,d));_.push(o),f=re(f),_=re(_),this.setCoordinates([f.concat(r,_.reverse(),[this.swallowTailPnt,f[0]])])}else this.setCoordinates([this.points])}}class Se extends Ae{constructor(e){super([]),Object.defineProperty(this,"swallowTailFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"swallowTailPnt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.TAILED_SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(e)}getTailPoints(e){var t=K(e)*this.tailWidthFactor,i=J(e[1],e[0],W.HALF_PI,t,!1),n=J(e[1],e[0],W.HALF_PI,t,!0),r=t*this.swallowTailFactor;return[i,J(e[1],e[0],0,r,!0),n]}}class Ie extends le{constructor(e){super([]),Object.defineProperty(this,"sideCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lengthScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.TRIANGLE,this.fixPointCount=2,this.sideCount=3,this.lengthScale=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=this.points[1],i=i(e,t),n=i/this.lengthScale,r=J(e,t,Math.PI/2,n/2,!1),s=J(e,t,Math.PI/2,n/2,!0);this.setCoordinates([[r,s,e]])}}}class Te extends le{constructor(e,t){super([]),Object.defineProperty(this,"sideCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.REGULARPOLYGON,this.fixPointCount=2,this.sideCount=5,t&&t.sideCount&&(this.sideCount=t.sideCount),this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=this.points[1],i=Math.PI*(this.sideCount-2)/this.sideCount,n=k(e,t);let a;a=this.sideCount%2==0?n/Math.tan(i/2):Math.cos(i/2)*(n/(1+Math.sin(i/2)))*2;for(var r=[J(e,t,Math.PI/2,a/2,!1),J(e,t,Math.PI/2,a/2,!0)],s=0;s<this.sideCount-2;s++){var o=J(r[s],r[s+1],i,a,!0);r.push(o)}this.setCoordinates([r])}}}class je extends le{constructor(e){super([]),Object.defineProperty(this,"sideCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lengthScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=G.DIAMOND,this.fixPointCount=2,this.sideCount=8,this.lengthScale=2,this.setPoints(e)}generate(){if(!(this.getPointCount()<2)){var e=this.points[0],t=this.points[1],i=i(e,t),n=Math.PI/this.sideCount,r=i*Math.cos(Math.PI/10)+i*Math.sin(n/2)/Math.tan(n),s=[e];s.push(J(t,e,n/2,r,!1));for(var o=0;o<this.sideCount-1;o++)s.push(J(s[o],s[o+1],n,r,!1));this.setCoordinates([s])}}}class Me extends p.a{constructor(e){super(),Object.defineProperty(this,"points",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plot",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"feature",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotType",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotParams",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"dblClickZoomInteraction",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"drawSource",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"drawLayer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"map_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapFirstClickHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapNextClickHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapDoubleClickHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapMouseMoveHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null});let t=Object.assign({map:null,style:new a.b({fill:new l.a({color:"rgba(0,0,0,0.4)"}),stroke:new h.a({color:"#000000",width:1.25})})},e);this.style=t.style,this.drawSource=new g.default,this.drawLayer=new b.default({source:this.drawSource}),this.drawLayer.setStyle(this.style),this.setMap(t.map)}setMap(e){this.map_=e}activate(e,t){this.deactivate(),this.deactivateMapTools(),this.mapFirstClickHandlerKey=this.map_.on("click",this.mapFirstClickHandler.bind(this)),this.plotType=e,this.plotParams=t,this.map_.addLayer(this.drawLayer)}deactivate(){this.activateMapTools(),this.disconnectEventHandlers(),this.map_.removeLayer(this.drawLayer),this.drawSource.clear(),this.points=[],this.plot=null,this.feature=null,this.plotType=null,this.plotParams=null}isDrawing(){return null!=this.plotType}mapFirstClickHandler(e){this.points.push(e.coordinate),this.plot=function(e,t,i){switch(e){case G.ARC:return new ae(t);case G.ELLIPSE:return new ge(t);case G.CURVE:return new _e(t);case G.CLOSED_CURVE:return new fe(t);case G.LUNE:return new Pe(t);case G.SECTOR:return new Oe(t);case G.GATHERING_PLACE:return new me(t);case G.STRAIGHT_ARROW:return new Fe(t);case G.ASSAULT_DIRECTION:return new ue(t);case G.ATTACK_ARROW:return new ce(t);case G.FINE_ARROW:return new he(t);case G.CIRCLE:return new de(t);case G.DOUBLE_ARROW:return new pe(t);case G.TAILED_ATTACK_ARROW:return new Ce(t);case G.SQUAD_COMBAT:return new Ae(t);case G.TAILED_SQUAD_COMBAT:return new Se(t);case G.FREEHAND_LINE:return new be(t);case G.FREEHAND_POLYGON:return new ye(t);case G.POLYGON:return new le(t);case G.POINT:return new ve(t);case G.RECTANGLE:return new we(t);case G.POLYLINE:return new oe(t);case G.TRIANGLE:return new Ie(t);case G.REGULARPOLYGON:return new Te(t,i);case G.DIAMOND:return new je(t)}return null}(this.plotType,this.points,this.plotParams),this.feature=new _.default(this.plot),this.drawSource.addFeature(this.feature),Object(r.c)(this.mapFirstClickHandlerKey),this.plot.fixPointCount!=this.plot.getPointCount()?(this.mapNextClickHandlerKey=this.map_.on("click",this.mapNextClickHandler.bind(this)),this.plot.freehand||(this.mapDoubleClickHandlerKey=this.map_.on("dblclick",this.mapDoubleClickHandler.bind(this))),this.mapMouseMoveHandlerKey=this.map_.on("pointermove",this.mapMouseMoveHandler.bind(this))):this.mapDoubleClickHandler(e)}mapMouseMoveHandler(e){var t=e.coordinate;if(!(k(t,this.points[this.points.length-1])<W.ZERO_TOLERANCE))if(this.plot.freehand)this.points.push(t),this.plot.setPoints(this.points);else{var i=this.points.concat([t]);this.plot.setPoints(i)}}mapNextClickHandler(e){!this.plot.freehand&&k(e.coordinate,this.points[this.points.length-1])<W.ZERO_TOLERANCE||(this.points.push(e.coordinate),this.plot.setPoints(this.points),this.plot.fixPointCount!=this.plot.getPointCount()?this.plot&&this.plot.freehand&&this.mapDoubleClickHandler(e):this.mapDoubleClickHandler(e))}mapDoubleClickHandler(e){this.disconnectEventHandlers(),this.plot.finishDrawing(),e.preventDefault(),this.drawEnd()}disconnectEventHandlers(){Object(r.c)(this.mapFirstClickHandlerKey),Object(r.c)(this.mapNextClickHandlerKey),Object(r.c)(this.mapMouseMoveHandlerKey),Object(r.c)(this.mapDoubleClickHandlerKey)}drawEnd(){this.drawSource.removeFeature(this.feature),setTimeout(()=>{this.activateMapTools()},250),this.disconnectEventHandlers(),this.map_.removeLayer(this.drawLayer),this.points=[],this.plot=null,this.plotType=null,this.plotParams=null,this.dispatchEvent("draw_end"),this.feature=null}deactivateMapTools(){for(var e=this.map_.getInteractions(),t=e.getLength(),i=0;i<t;i++){var n=e.item(i);if(n instanceof o.a){this.dblClickZoomInteraction=n,n.setActive(!1);break}}}activateMapTools(){null!=this.dblClickZoomInteraction&&this.dblClickZoomInteraction.setActive(!0)}setStyle(e){this.style=e,this.drawLayer.setStyle(this.style)}}var Le=0;function Ee(e){let t="_p_id_";return e[t]=e[t]||Le++,e[t]}function He(e,t,i,n){let r=document.createElement(e);return r.className=t||"",n&&(r.id=n),i&&i.appendChild(r),r}function xe(e){return document.getElementById(e)}function Re(e,t,i){return"_p_dom_event_"+e+"_"+Ee(t)+(i?"_"+Ee(i):"")}function Ne(e,t,i,n){var r=Re(t,i,n),s=e[r];return s||(s=function(t){return i.call(n||e,t)},e.addEventListener(t,s,!1),e[r]=s),this}function De(e,t,i,n){var r=Re(t,i,n),s=e[r];return s?(e.removeEventListener(t,s,!1),e[r]=null,this):this}class Ge extends p.a{constructor(e){super(),Object.defineProperty(this,"map_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"activePlot",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startPoint",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"ghostControlPoints",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"controlPoints",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mouseOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"elementTable",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"activeControlPointId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapDragPan",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"controlPointMouseMoveHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"controlPointMouseUpHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotMouseOverOutHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotMouseDownHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotMouseMoveHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"plotMouseUpHandlerKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"Constants",{enumerable:!0,configurable:!0,writable:!0,value:{HELPER_HIDDEN_DIV:"p-helper-hidden-div",HELPER_CONTROL_POINT_DIV:"p-helper-control-point-div"}}),e&&this.setMap(e)}setMap(e){this.map_=e}initHelperDom(){if(this.map_&&this.activePlot){var e=this.getMapParentElement();if(e)for(var t=function(e,t,i){var n=document.createElement(e);return n.style.display="none",i&&(n.id=i),t&&t.appendChild(n),n}("div",e,this.Constants.HELPER_HIDDEN_DIV),i=this.getControlPoints(),n=0;n<i.length;n++){var r=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+n;He("div",this.Constants.HELPER_CONTROL_POINT_DIV,t,r),this.elementTable[r]=n}}}getMapParentElement(){var e=this.map_.getTargetElement();if(e)return e.parentNode}destroyHelperDom(){if(this.controlPoints){for(var e=0;e<this.controlPoints.length;e++){this.map_.removeOverlay(this.controlPoints[e]);var t=xe(this.Constants.HELPER_CONTROL_POINT_DIV+"-"+e);t&&(De(t,"mousedown",this.controlPointMouseDownHandler,this),De(t,"mousemove",this.controlPointMouseMoveHandler2,this))}this.controlPoints=null}var i=this.getMapParentElement(),n=xe(this.Constants.HELPER_HIDDEN_DIV);n&&i&&function(e,t){t&&e&&t.removeChild(e)}(n,i)}initControlPoints(){if(this.map_){this.controlPoints=[];for(var e=this.getControlPoints(),t=0;t<e.length;t++){var i=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+t,n=xe(i),r=new v.a({id:i,position:e[t],positioning:"center-center",element:n});this.controlPoints.push(r),this.map_.addOverlay(r),Ne(n,"mousedown",this.controlPointMouseDownHandler,this),Ne(n,"mousemove",this.controlPointMouseMoveHandler2,this)}}}controlPointMouseMoveHandler2(e){e.stopImmediatePropagation(e)}controlPointMouseDownHandler(e){var t=e.target.id;this.activeControlPointId=t,this.controlPointMouseMoveHandlerKey&&r.c(this.controlPointMouseMoveHandlerKey),this.controlPointMouseMoveHandlerKey=this.map_.on("pointermove",this.controlPointMouseMoveHandler.bind(this)),this.controlPointMouseUpHandlerKey=Ne(e.currentTarget,"mouseup",this.controlPointMouseUpHandler,this)}controlPointMouseMoveHandler(e){var t=e.coordinate;if(this.activeControlPointId){var i=this.activePlot.getGeometry(),n=this.elementTable[this.activeControlPointId];i.updatePoint(t,n),this.map_.getOverlayById(this.activeControlPointId).setPosition(t)}}controlPointMouseUpHandler(e){r.c(this.controlPointMouseMoveHandlerKey),De(e.currentTarget,"mouseup",this.controlPointMouseUpHandler,this)}activate(e){e&&e instanceof _.default&&e!=this.activePlot&&(e.getGeometry().isPlot()&&(this.deactivate(),this.activePlot=e,this.plotMouseOverOutHandlerKey=this.map_.on("pointermove",this.plotMouseOverOutHandler.bind(this)),this.initHelperDom(),this.initControlPoints()))}getControlPoints(){return this.activePlot?this.activePlot.getGeometry().getPoints():[]}plotMouseOverOutHandler(e){var t=this.map_.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));t&&t==this.activePlot?this.mouseOver||(this.mouseOver=!0,this.map_.getViewport().style.cursor="move",this.plotMouseDownHandlerKey=Ne(this.map_.getTargetElement(),"mousedown",this.plotMouseDownHandler,this)):this.mouseOver&&(this.mouseOver=!1,this.map_.getViewport().style.cursor="default",r.c(this.plotMouseDownHandlerKey))}plotMouseDownHandler(e){this.ghostControlPoints=this.getControlPoints(),this.startPoint=this.map_.getCoordinateFromPixel([e.layerX,e.layerY]),this.disableMapDragPan(),De(this.map_.getTargetElement(),"mousedown",this.plotMouseDownHandler,this),this.plotMouseMoveHandlerKey=this.map_.on("pointerdrag",this.plotMouseMoveHandler.bind(this))}plotMouseMoveHandler(e){for(var t=e.coordinate,i=t[0]-this.startPoint[0],n=t[1]-this.startPoint[1],r=[],s=0;s<this.ghostControlPoints.length;s++){var o=this.ghostControlPoints[s],a=[o[0]+i,o[1]+n];r.push(a);var l=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+s,h=this.map_.getOverlayById(l);h.setPosition(a),h.setPositioning("center-center")}this.activePlot.getGeometry().setPoints(r)}plotMouseUpHandler(e){this.enableMapDragPan(),r.c(this.plotMouseUpHandlerKey),r.c(this.plotMouseMoveHandlerKey)}disconnectEventHandlers(){r.c(this.plotMouseOverOutHandlerKey),r.c(this.controlPointMouseMoveHandlerKey),r.c(this.controlPointMouseUpHandlerKey),r.c(this.plotMouseDownHandlerKey),r.c(this.plotMouseUpHandlerKey),r.c(this.plotMouseMoveHandlerKey)}deactivate(){this.activePlot=null,this.mouseOver=!1,this.destroyHelperDom(),this.disconnectEventHandlers(),this.elementTable={},this.activeControlPointId=null,this.startPoint=null}disableMapDragPan(){for(var e=this.map_.getInteractions(),t=e.getLength(),i=0;i<t;i++){var n=e.item(i);if(n instanceof s.a){this.mapDragPan=n,n.setActive(!1);break}}}enableMapDragPan(){null!=this.mapDragPan&&(this.mapDragPan.setActive(!0),this.mapDragPan=null)}}var We=Object.freeze({__proto__:null,PlotDraw:Me,PlotEdit:Ge}),ke=Object.freeze({__proto__:null,PlotTypes:G,tool:We});const Ue={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},Ke=e=>e<=1?1:e*Ke(e-1),Be=e=>parseFloat(e.toFixed(12)),Ve=(e,t)=>{if(e===t)return!0;const[i,n]=e,[r,s]=t;return Be(i)===Be(r)&&Be(n)===Be(s)};function Ye(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function ze(e){let t=0;for(var i=0;i<e.length-1;i++)t+=Ye(e[i],e[i+1]);return t}function qe(e,t,i,n){if(e[1]==t[1]){var r=(n[0]-i[0])/(n[1]-i[1]),s=r*(e[1]-i[1])+i[0],o=e[1];return[s,o]}if(i[1]==n[1]){var a=(t[0]-e[0])/(t[1]-e[1]);return[s=a*(i[1]-e[1])+e[0],o=i[1]]}return a=(t[0]-e[0])/(t[1]-e[1]),r=(n[0]-i[0])/(n[1]-i[1]),[s=a*(o=(a*e[1]-e[0]-r*i[1]+i[0])/(a-r))-a*e[1]+e[0],o]}function Ze(e,t){var i,n=Math.asin(Math.abs(t[1]-e[1])/Ye(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=n+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=Ue.TWO_PI-n:t[1]<e[1]&&t[0]<e[0]?i=n:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-n),i}const Je=(e,t,i={units:"degrees"})=>{var n=w.lineString(e);return w.along(n,t,i).geometry.coordinates},Qe=(e,t,i={units:"degrees"})=>{let n=w.lineString(e),r=w.length(n,i);return Je(e,r*t)},Xe=(e,t,i)=>{let n=w.lineString(e),r=w.point(t),s=w.point(i);return w.lineSlice(r,s,n).geometry.coordinates},$e=(e,t,i,n={units:"degrees"})=>{let r=Qe(e,t,n),s=Qe(e,i,n);return Xe(e,r,s)},et=(e=[],t=.01)=>{if(e.length<=2||t<=0)return e;let i=0,n=0;const r=e.length-1,s=[];for(let o=0;o<1;o+=t){i=0,n=0;for(let t=0;t<=r;t++){const[s,a]=e[t];i+=Ke(r)/(Ke(t)*Ke(r-t))*Math.pow(1-o,r-t)*Math.pow(o,t)*s,n+=Ke(r)/(Ke(t)*Ke(r-t))*Math.pow(1-o,r-t)*Math.pow(o,t)*a}s.push([i,n])}return s.push(e[e.length-1]),s},tt=(e,t,i=0,n=90,r=.01)=>{const[s,o]=e,[a,l]=t,h=(s+a)/2,u=(o+l)/2,c=(o-l)/(s-a),d=n*Math.PI/180+Math.atan(c),f=h+i*Math.cos(d),_=u+i*Math.sin(d);return et([e,[f,_],t],r)},it=(e=[],t=.01)=>{const i=[];for(let n=0;n<e.length&&!(n>=e.length-1);n++){const[r,s]=e[n],[o,a]=e[n+1],l=Math.atan2(Math.abs(s-a),Math.abs(r-o))*(180/Math.PI);if(i.push([r,s]),l>45){const e=t*Math.sign(a-s);let n=s+e;for(;e>0?n<a:n>a;){const t=(n-s)*(o-r)/(a-s)+r;i.push([t,n]),n+=e}}else{const e=t*Math.sign(o-r);let n=r+e;for(;e>0?n<o:n>o;){const t=(a-s)/(o-r)*(n-r)+s;i.push([n,t]),n+=e}}i.push([o,a])}return[...new Set(i)]};function nt(e,t,i,n){var r,s,o=[],a=n-i;a=a<0?a+Ue.TWO_PI:a;for(var l=0;l<=Ue.FITTING_COUNT;l++){var h=i+a*l/Ue.FITTING_COUNT;r=e[0]+t*Math.cos(h),s=e[1]+t*Math.sin(h),o.push([r,s])}return o}var rt=Object.freeze({__proto__:null,Constants:Ue,factorial:Ke,parseDecimal:Be,equal:Ve,getDistance:Ye,getLength:ze,getBaseLength:function(e){return Math.pow(ze(e),.99)},getMid:function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},getCircleCenterOfThreePoints:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],r=[n[0]-e[1]+t[1],n[1]+e[0]-t[0]],s=[(e[0]+i[0])/2,(e[1]+i[1])/2];return qe(n,r,s,[s[0]-e[1]+i[1],s[1]+e[0]-i[0]])},getIntersectPoint:qe,getAzimuth:Ze,getAngleOfThreePoints:function(e,t,i){var n=Ze(t,e)-Ze(t,i);return n<0?n+Ue.TWO_PI:n},isClockWise:function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])},getThirdPoint:function(e,t,i,n,r=!0){var s=Ze(e,t),o=r?s+i:s-i,a=n*Math.cos(o),l=n*Math.sin(o);return[t[0]+a,t[1]+l]},getCoordinateByDistance:Je,getCoordinateByScale:Qe,getCoordinateByPoint:(e,t)=>{let i;i=t[0][0]instanceof Array?e:[e];let n=w.multiLineString(i),r=w.point(t);return w.nearestPointOnLine(n,r,{units:"degrees"}).geometry.coordinates},sliceByPoint:Xe,sliceByDistance:(e,t,i,n={units:"degrees"})=>{let r=Je(e,t,n),s=Je(e,i,n);return Xe(e,r,s)},sliceByScale:$e,createBezierCurve:et,createCurve:tt,linearInterpolate:it,getArc:nt});const st={fill:l.a,text:u.a,stroke:h.a,circle:c.a,icon:d.a,regularShape:f.a,backgroundFill:l.a,backgroundStroke:h.a},ot=[c.a,d.a,f.a];function at(e){return"object"==typeof e}function lt(e,t,i){if(null!=i)return e?["fill","backgroundFill"].includes(t)?function(e){const t=at(e)?e:{color:e};return new l.a(t)}(i):"text"===t?at(i)?ht(i,e):i:ht(i,e):i}function ht(e,t){const i={};return Object.entries(e).forEach(([e,t])=>{const n=st[e];"font"===e&&(t+=" sans-serif"),i[ot.includes(n)?"image":e]=lt(n,e,t)}),new(t||a.b)(i)}var ut=Object.freeze({__proto__:null,default:ht});const ct={src:"data:image/svg+xml,%3c%3fxml version='1.0' standalone='no'%3f%3e%3c!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg t='1589093007551' class='icon' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='1173' xmlns:xlink='http://www.w3.org/1999/xlink' width='200' height='200'%3e %3cpath d='M1004.87987695 512L33.95798397 34.76720507 282.15195014 510.65058287 33.95798397 989.23279493Z' fill='white'%3e%3c/path%3e%3c/svg%3e",anchor:[.75,.5],rotateWithView:!0,rotation:0,color:"#409eff",scale:1};const dt=(e,t,i={})=>{const n=t[0]-e[0],r=t[1]-e[1],s=Object.assign(Object.assign({},ct),"string"==typeof i?{src:i}:i);return s.rotation=-Math.atan2(r,n),s.scale=16*s.scale/200,s.opacity=function(e=""){if("transparent"===e)return 0;const t=e.match(/\.\d*/);return t&&t[0]?parseFloat(t[0]):1}(s.color),ht({geometry:new P.a(t),icon:s})};var ft=Object.freeze({__proto__:null,createArrow:dt});const _t=(e,t)=>{const i=e.length;let n=0;const r=e[i-1];let s=r;for(;s&&Ve(s,r);)++n,s=e[i-n];return dt(s||r,r,t)},pt={coordinates:null,lineStyle:{stroke:{color:"green",width:8}},arrowStyle:{color:"#ffffff",src:"data:image/svg+xml,%3csvg width='14' height='24' xmlns='http://www.w3.org/2000/svg'%3e %3ctitle%3e%e5%88%87%e7%89%87%3c/title%3e %3cg%3e %3ctitle%3ebackground%3c/title%3e %3crect x='-1' y='-1' width='16' height='26' id='canvas_background' fill='none'/%3e %3c/g%3e %3cg%3e %3ctitle%3eLayer 1%3c/title%3e %3cg fill-rule='evenodd' fill='none' id='%e9%a1%b5%e9%9d%a2-1' transform='translate(14%2c24)rotate(180)'%3e %3cg fill='white' id='%e9%a3%8e%e9%99%a9%e9%a2%84%e8%ad%a6%ef%bc%88%e9%a3%8e%e9%99%a9%e5%8c%ba%e8%af%a6%e6%83%85%ef%bc%89%e5%9c%b0%e5%9b%be%e8%af%a6%e6%83%85'%3e %3cg id='%e7%bc%96%e7%bb%84'%3e %3cg id='icon/%e8%b7%af%e6%a0%87%e7%ae%ad%e5%a4%b4%e5%a4%87%e4%bb%bd-7' %3e %3cpolygon points='7.855979919433594%2c6.407499313354492e-7 13.5625%2c6.407499313354492e-7 6.144020080566406%2c11.875000953674316 13.5625%2c23.75 7.855979919433594%2c23.75 0.4375%2c11.875000953674316 ' id='%e7%9f%a9%e5%bd%a2'/%3e %3c/g%3e %3c/g%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/svg%3e",scale:4.5,rotation:Math.PI/2},interval:20,source:null};const gt={coordinates:null,outlineColor:"#ff0000",outlineWidth:8,innerlineColor:"#ffffff",innerlineWidth:6,innerlineDash:[0,12],innerlineDashOffset:0,source:null};const bt={color:"#409eff"},yt=(e,t)=>{const i=e.length;let n=0;const r=e[i-1];let s=r;for(;s&&Ve(s,r);)++n,s=e[i-n];return dt(s||r,r,t)},mt={from:null,to:null,radius:0,angle:90,loop:!0,space:.01,smooth:.01,endArrow:bt,animationArrow:bt,lineStyle:{stroke:{color:"#409eff",lineDash:[5],width:3}},lineAnimationStyle:{stroke:{width:3,color:"#409eff"}},pointAnimationStyle:{circle:{fill:"#409eff",radius:3}},source:null};class Pt extends O.a{constructor(e){super(),Object.defineProperty(this,"from_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"to_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"radius_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"angle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"space_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"smooth_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endArrow_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationArrow_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineAnimationStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointAnimationStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"lineAnimationFeature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pointAnimationFeature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fraction_",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aId_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:!1});let t=Object.assign({},mt,e);this.setFrom(t.from),this.setTo(t.to),this.setRadius(t.radius),this.setAngle(t.angle),this.setLoop(t.loop),this.setSpace(t.space),this.setSmooth(t.smooth),this.setEndArrow(t.endArrow),this.setAnimationArrow(t.animationArrow),this.setLineStyle(t.lineStyle),this.setLineAnimationStyle(t.lineAnimationStyle),this.setPointAnimationStyle(t.pointAnimationStyle),this.setSource(t.source),this.init_(),this.ready=!0}start(){this.aId_||this.animation_()}stop(){this.aId_&&(window.cancelAnimationFrame(this.aId_),this.aId_=null)}end(){this.aId_&&window.cancelAnimationFrame(this.aId_),this.source_.removeFeature(this.lineAnimationFeature_),this.source_.removeFeature(this.pointAnimationFeature_),this.fraction_=0,this.pointAnimationFeature_=null,this.lineAnimationFeature_=null,this.aId_=null}init_(){if(this.initLineFeature_(),!this.feature_)return;let e=[];this.lineStyle_ instanceof Array?e=e.concat(this.lineStyle_):this.lineStyle_ instanceof Function&&(e=this.lineStyle_({target:this,feature:this.feature_}),e instanceof a.b&&(e=[e])),this.endArrow_&&(this.endArrow_ instanceof Function?e.push(this.endArrow_({target:this,feature:this.feature_})):this.endArrow_ instanceof Boolean?e.push(yt(this.feature_.getGeometry().getCoordinates(),{})):e.push(yt(this.feature_.getGeometry().getCoordinates(),this.endArrow_))),this.feature_.setStyle(e)}initLineFeature_(){const e=this.createPoints_();if(this.feature_)this.feature_.getGeometry().setCoordinates(e);else{const t=new y.default(e);this.feature_=new _.default({geometry:t}),this.source_.addFeature(this.feature_)}}createPoints_(){const e=this.radius_>0?tt(this.from_,this.to_,this.radius_,this.angle_,this.smooth_):[this.from_,this.to_];return this.space_?it(e,this.space_):e}animation_(){const e=()=>{let t=this.feature_.getGeometry().getCoordinates(),i=t.length;if(this.lineAnimationFeature_||(this.lineAnimationFeature_=new _.default(new y.default([t[0]])),this.source_.addFeature(this.lineAnimationFeature_)),this.pointAnimationFeature_||(this.pointAnimationFeature_=new _.default(new P.a(t[0])),this.source_.addFeature(this.pointAnimationFeature_)),++this.fraction_,this.fraction_>=i){if(!this.loop_)return;this.fraction_=1}this.renderLine_(t,this.fraction_),this.renderPoint_(t,this.fraction_),this.aId_=window.requestAnimationFrame(e)};e()}renderLine_(e,t){const i=e.slice(0,t+1),n=new y.default(i);this.lineAnimationFeature_.setGeometry(n);let r=[];this.lineAnimationStyle_ instanceof Array?r=r.concat(this.lineAnimationStyle_):this.lineAnimationStyle_ instanceof Function&&(r=this.lineAnimationStyle_({feature:this.lineAnimationFeature_,fraction:t,target:this}),r instanceof a.b&&(r=[r])),this.animationArrow_&&(this.animationArrow_ instanceof Function?r.push(this.animationArrow_({target:this,feature:this.feature_})):this.animationArrow_ instanceof Boolean?r.push(yt(i,{})):r.push(yt(i,this.animationArrow_))),this.lineAnimationFeature_.setStyle(r)}renderPoint_(e,t){const i=e[t],n=new P.a(i);this.pointAnimationFeature_.setGeometry(n);let r=[];this.pointAnimationStyle_ instanceof Array?r=r.concat(this.pointAnimationStyle_):this.pointAnimationStyle_ instanceof Function&&(r=this.pointAnimationStyle_({feature:this.pointAnimationFeature_,fraction:t,target:this}),r instanceof a.b&&(r=[r])),this.pointAnimationFeature_.setStyle(r)}setFrom(e){this.from_=e,this.ready&&this.init_()}setTo(e){this.to_=e,this.ready&&this.init_()}setRadius(e){this.radius_=e,this.ready&&this.init_()}setAngle(e){this.angle_=e,this.ready&&this.init_()}setSpace(e){this.space_=e,this.ready&&this.init_()}setSmooth(e){this.smooth_=e,this.ready&&this.init_()}setLoop(e){this.loop_=e}setEndArrow(e){this.endArrow_=e,this.ready&&this.init_()}setAnimationArrow(e){this.animationArrow_=e}setLineStyle(e){e instanceof a.b?this.lineStyle_=[e]:e instanceof Function||e instanceof Array?this.lineStyle_=e:e instanceof Object&&(this.lineStyle_=[ht(e)]),this.ready&&this.init_()}setLineAnimationStyle(e){e instanceof a.b?this.lineAnimationStyle_=[e]:e instanceof Function||e instanceof Array?this.lineAnimationStyle_=e:e instanceof Object&&(this.lineAnimationStyle_=[ht(e)])}setPointAnimationStyle(e){e instanceof a.b?this.pointAnimationStyle_=[e]:e instanceof Function||e instanceof Array?this.pointAnimationStyle_=e:e instanceof Object&&(this.pointAnimationStyle_=[ht(e)])}setSource(e){if(this.source_){let e=this.source_;this.feature_&&e.removeFeature(this.feature_),this.lineAnimationFeature_&&e.removeFeature(this.lineAnimationFeature_),this.pointAnimationFeature_&&e.removeFeature(this.pointAnimationFeature_)}this.source_=e,this.feature_&&e.addFeature(this.feature_),this.lineAnimationFeature_&&e.addFeature(this.lineAnimationFeature_),this.pointAnimationFeature_&&e.addFeature(this.pointAnimationFeature_)}setFraction(e){this.fraction_=e}getFrom(){return this.from_}getTo(){return this.to_}getRadius(){return this.radius_}getAngle(){return this.angle_}getLoop(){return this.loop_}getSpace(){return this.space_}getSmooth(){return this.smooth_}getEndArrow(){return this.endArrow_}getAnimationArrow(){return this.animationArrow_}getLineStyle(){return this.lineStyle_}getLineAnimationStyle(){return this.lineAnimationStyle_}getPointAnimationStyle(){return this.pointAnimationStyle_}getFeature(){return this.feature_}getLineAnimationFeature(){return this.lineAnimationFeature_}getPointAnimationFeature(){return this.pointAnimationFeature_}getSource(){return this.source_}getFraction_(){return this.fraction_}}const vt={coordinate:null,innerRadius:10,outerRadius:50,innerOpacity:1,outerOpacity:0,loop:!0,source:null,centerStyle:{zIndex:10,circle:{fill:{color:"#ff0000"},radius:10,stroke:{width:2,color:"#ffff0000"}}},rippleStyle:{zIndex:10,circle:{fill:{color:"#ff0000"},stroke:{width:2,color:"#ffff0000"}}},period:1.5};class wt extends O.a{constructor(e){super(),Object.defineProperty(this,"coordinate_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerRadius_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outerRadius_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerOpacity_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outerOpacity_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"period_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"centerStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rippleStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aId_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=Object.assign({},vt,e);this.setCoordinate(t.coordinate),this.setInnerRadius(t.innerRadius),this.setOuterRadius(t.outerRadius),this.setInnerOpacity(t.innerOpacity),this.setOuterOpacity(t.outerOpacity),this.setLoop(t.loop),this.setSource(t.source),this.setCenterStyle(t.centerStyle),this.setRippleStyle(t.rippleStyle),this.setPeriod(t.period),this.init_()}init_(){let e=new P.a(this.coordinate_);if(!e)return;if(this.feature_=new _.default({geometry:e}),this.source_.addFeature(this.feature_),!this.feature_)return;let t=this.centerStyle_;this.feature_.setStyle(t)}start(){this.animation_()}end(){window.cancelAnimationFrame(this.aId_)}dispose(){this.end(),this.source_.removeFeature(this.feature_),this.feature_=null}animation_(){const e=this.period_,t=(new Date).getTime(),i=()=>{const n=((new Date).getTime()-t)/(1e3*e);if(n>1)return void(this.loop_&&this.animation_());const r=Object(A.b)(n),s=this.innerRadius_+(this.outerRadius_-this.innerRadius_)*r,o=this.innerOpacity_-(this.innerOpacity_-this.outerOpacity_)*r;let l=[];this.centerStyle_ instanceof Array?l=l.concat(this.centerStyle_):this.centerStyle_ instanceof Function&&(l=this.centerStyle_({target:this,fraction:r}),l instanceof a.b&&(l=[l]));let h=[];this.rippleStyle_ instanceof Array?(h=h.concat(this.rippleStyle_),h.forEach(e=>{e.getImage().setRadius(s),e.getImage().setOpacity(o)})):this.rippleStyle_ instanceof Function&&(h=this.rippleStyle_({target:this,radius:s,opacity:o,fraction:r}),h instanceof a.b&&(h=[h])),this.feature_.setStyle(h.concat(l)),this.aId_=window.requestAnimationFrame(i)};i()}setCoordinate(e){this.coordinate_=e,this.feature_&&this.feature_.getGeometry().setCoordinates(this.coordinate_)}setInnerRadius(e){this.innerRadius_=e}setOuterRadius(e){this.outerRadius_=e}setInnerOpacity(e){this.innerOpacity_=e}setOuterOpacity(e){this.outerOpacity_=e}setLoop(e){this.loop_=e}setPeriod(e){this.period_=e}setCenterStyle(e){e instanceof a.b?this.centerStyle_=[e]:e instanceof Function||e instanceof Array?this.centerStyle_=e:e instanceof Object&&(this.centerStyle_=[ht(e)])}setRippleStyle(e){e instanceof a.b?this.rippleStyle_=[e]:e instanceof Function||e instanceof Array?this.rippleStyle_=e:e instanceof Object&&(this.rippleStyle_=[ht(e)])}setSource(e){this.source_&&this.feature_&&this.source_.removeFeature(this.feature_),this.source_=e,this.feature_&&this.source_.addFeature(this.feature_)}getCoordinate(){return this.coordinate_}getInnerRadius(){return this.innerRadius_}getOuterRadius(){return this.outerRadius_}getInnerOpacity(){return this.innerOpacity_}getOuterOpacity(){return this.outerOpacity_}getLoop(){return this.loop_}getPeriod(){return this.period_}getCenterStyle(){return this.centerStyle_}getRippleStyle(){return this.rippleStyle_}getSource(){return this.source_}getFeature(){return this.feature_}}class Ot extends F.a{constructor(e,t,i){super(e),Object.defineProperty(this,"coordinate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"angle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.coordinate=t,this.angle=i}}const At={coordinates:null,loop:!0,lineStyle:{stroke:{color:"#409eff",lineDash:[5],width:3}},lineAnimationStyle:{stroke:{width:3,color:"#409eff"}},pointAnimationStyle:{circle:{fill:"#409eff",radius:3}},source:null};class Ft extends O.a{constructor(e){super(),Object.defineProperty(this,"coordinates_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineAnimationStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointAnimationStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"lineAnimationFeature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pointAnimationFeature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fraction_",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aId_",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=Object.assign({},At,e);this.setCoordinates(t.coordinates),this.setLoop(t.loop),this.setLineStyle(t.lineStyle),this.setLineAnimationStyle(t.lineAnimationStyle),this.setPointAnimationStyle(t.pointAnimationStyle),this.setSource(t.source),this.init_()}start(){this.aId_||this.animation_()}stop(){this.aId_&&(window.cancelAnimationFrame(this.aId_),this.aId_=null)}end(){this.aId_&&window.cancelAnimationFrame(this.aId_),this.source_.removeFeature(this.lineAnimationFeature_),this.source_.removeFeature(this.pointAnimationFeature_),this.fraction_=0,this.pointAnimationFeature_=null,this.lineAnimationFeature_=null,this.aId_=null}init_(){const e=this.createPoints_(),t=new y.default(e);if(!t)return;if(this.feature_=new _.default({geometry:t}),this.source_.addFeature(this.feature_),!this.feature_)return;let i=[];this.lineStyle_ instanceof Array?i=i.concat(this.lineStyle_):this.lineStyle_ instanceof Function&&(i=this.lineStyle_({target:this}),i instanceof a.b&&(i=[i])),this.feature_.setStyle(i)}createPoints_(){return this.coordinates_}animation_(){let e,t,i;e||(e=this.feature_.getGeometry()),t||(t=e.getCoordinates()),i||(i=t.length),this.lineAnimationFeature_||(this.lineAnimationFeature_=new _.default(new y.default([t[0]])),this.source_.addFeature(this.lineAnimationFeature_)),this.pointAnimationFeature_||(this.pointAnimationFeature_=new _.default(new P.a(t[0])),this.source_.addFeature(this.pointAnimationFeature_));let n=(new Date).getTime();const r=()=>{let e=((new Date).getTime()-n)/1e4;if(e+=this.fraction_,e>1){if(this.fraction_=0,!this.loop_)return;n=(new Date).getTime()}const i=Qe(t,e),s=Ze(i,Qe(t,e+1e-5));this.dispatchEvent(new Ot("move",i,s)),this.renderLine_(t,e,s),this.renderPoint_(t,e,s),this.aId_=window.requestAnimationFrame(r)};r()}renderLine_(e,t,i){const n=$e(e,0,t),r=new y.default(n);this.lineAnimationFeature_.setGeometry(r);let s=[];this.lineAnimationStyle_ instanceof Array?s=s.concat(this.lineAnimationStyle_):this.lineAnimationStyle_ instanceof Function&&(s=this.lineAnimationStyle_({target:this,fraction:t}),s instanceof a.b&&(s=[s])),this.lineAnimationFeature_.setStyle(s)}renderPoint_(e,t,i){const n=Qe(e,t);Qe(e,t+1e-5);const r=new P.a(n);this.pointAnimationFeature_.setGeometry(r);let s=[];this.pointAnimationStyle_ instanceof Array?s=s.concat(this.pointAnimationStyle_):this.pointAnimationStyle_ instanceof Function&&(s=this.pointAnimationStyle_({target:this,angle:i,fraction:t}),s instanceof a.b&&(s=[s])),this.pointAnimationFeature_.setStyle(s)}setCoordinates(e){this.coordinates_=e,this.feature_&&this.feature_.getGeometry().setCoordinates(this.coordinates_)}setLoop(e){this.loop_=e}setLineStyle(e){e instanceof a.b?this.lineStyle_=[e]:e instanceof Function||e instanceof Array?this.lineStyle_=e:e instanceof Object&&(this.lineStyle_=[ht(e)])}setLineAnimationStyle(e){e instanceof a.b?this.lineAnimationStyle_=[e]:e instanceof Function||e instanceof Array?this.lineAnimationStyle_=e:e instanceof Object&&(this.lineAnimationStyle_=[ht(e)])}setPointAnimationStyle(e){e instanceof a.b?this.pointAnimationStyle_=[e]:e instanceof Function||e instanceof Array?this.pointAnimationStyle_=e:e instanceof Object&&(this.pointAnimationStyle_=[ht(e)])}setSource(e){if(this.source_){let e=this.source_;this.feature_&&e.removeFeature(this.feature_),this.lineAnimationFeature_&&e.removeFeature(this.lineAnimationFeature_),this.pointAnimationFeature_&&e.removeFeature(this.pointAnimationFeature_)}this.source_=e,this.feature_&&e.addFeature(this.feature_),this.lineAnimationFeature_&&e.addFeature(this.lineAnimationFeature_),this.pointAnimationFeature_&&e.addFeature(this.pointAnimationFeature_)}setFraction(e){this.fraction_=e}getCoordinate(){return this.coordinates_}getLoop(){return this.loop_}getLineStyle(){return this.lineStyle_}getLineAnimationStyle(){return this.lineAnimationStyle_}getPointAnimationStyle(){return this.pointAnimationStyle_}getFeature(){return this.feature_}getLineAnimationFeature(){return this.lineAnimationFeature_}getPointAnimationFeature(){return this.pointAnimationFeature_}getSource(){return this.source_}getFraction_(){return this.fraction_}}const Ct={radius:10,center:[0,0],period:5,startAngle:0,arcAngle:1,loop:!0,source:null,centerStyle:{circle:{fill:"#ff0000",radius:3}},circleStyle:{stroke:{color:"#ff0000"},fill:{color:"rgba(255,0,0,0.1)"}},arcStyle:{fill:{color:"rgba(255,0,0,0.01)"},stroke:{color:"rgba(0,0,0,0)",width:2}}};class St extends O.a{constructor(e){super(),Object.defineProperty(this,"radius_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"center_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startAngle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arcAngle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"period_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"centerStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"circleStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arcStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"centerFeature_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"circleFeature_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arcFeatures_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aId_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentAngle_",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:!1});let t=Object.assign({},Ct,e);this.source_=t.source,this.radius_=t.radius,this.center_=t.center,this.startAngle_=t.startAngle,this.arcAngle_=t.arcAngle,this.loop_=t.loop,this.period_=t.period,this.setCenterStyle(t.centerStyle),this.setCircleStyle(t.circleStyle),this.setArcStyle(t.arcStyle),this.init_(),this.ready=!0}init_(e=!1){this.renderArc_(e),this.renderCircle_(e),this.renderCenter_(e)}renderArc_(e=!1){if(!this.arcFeatures_){this.arcFeatures_=[];for(let e=0;e<100;e++){let t=nt(this.center_,this.radius_,this.currentAngle_-.01*this.arcAngle_*(e+1),this.currentAngle_);t.push(this.center_),t.unshift(this.center_),this.arcFeatures_.push(new _.default({geometry:new m.a([t])}))}this.source_.addFeatures(this.arcFeatures_)}for(let t=0;t<this.arcFeatures_.length;t++){let i=this.arcFeatures_[t];if(e){let e=nt(this.center_,this.radius_,this.currentAngle_-.01*this.arcAngle_*(t+1),this.currentAngle_);e.push(this.center_),e.unshift(this.center_),i.getGeometry().setCoordinates([e])}let n=[];this.arcStyle_ instanceof Array?n=n.concat(this.arcStyle_):this.arcStyle_ instanceof Function&&(n=this.arcStyle_({target:this,feature:i,index:t}),n instanceof a.b&&(n=[n])),i.setStyle(n)}}renderCenter_(e=!1){this.centerFeature_||(this.centerFeature_=new _.default({geometry:new P.a(this.center_)}),this.source_.addFeature(this.centerFeature_)),e&&this.centerFeature_.getGeometry().setCoordinates(this.center_);let t=[];this.centerStyle_ instanceof Array?t=t.concat(this.centerStyle_):this.centerStyle_ instanceof Function&&(t=this.centerStyle_({target:this,feature:this.centerFeature_}),t instanceof a.b&&(t=[t])),this.centerFeature_.setStyle(t)}renderCircle_(e=!1){this.circleFeature_||(this.circleFeature_=new _.default({geometry:new C.a(this.center_,this.radius_)}),this.source_.addFeature(this.circleFeature_)),e&&this.circleFeature_.getGeometry().setCenter(this.center_);let t=[];this.circleStyle_ instanceof Array?t=t.concat(this.circleStyle_):this.circleStyle_ instanceof Function&&(t=this.circleStyle_({target:this,feature:this.circleFeature_}),t instanceof a.b&&(t=[t])),this.circleFeature_.setStyle(t)}start(){this.animation_()}end(){window.cancelAnimationFrame(this.aId_)}animation_(){const e=(new Date).getTime(),t=()=>{const i=((new Date).getTime()-e)/(1e3*this.period_);i>1?this.loop_&&this.animation_():(this.currentAngle_=this.startAngle_+i*Math.PI*2,this.init_(!0),this.aId_=window.requestAnimationFrame(t))};t()}setCenter(e){this.center_=e,this.ready&&this.init_(!0)}setRadius(e){this.radius_=e,this.ready&&this.init_(!0)}setStartAngle(e){this.startAngle_=e,this.ready&&this.init_(!0)}setArcAngle(e){this.arcAngle_=e,this.ready&&this.init_(!0)}setPeriod(e){this.period_=e}setLoop(e){this.loop_=e}setSource(e){if(this.source_){this.centerFeature_&&this.source_.removeFeature(this.centerFeature_),this.circleFeature_&&this.source_.removeFeature(this.circleFeature_);for(let e=this.arcFeatures_.length;e>=0;e--)this.arcFeatures_&&this.source_.removeFeature(this.arcFeatures_[e])}this.source_=e,this.centerFeature_&&this.source_.addFeature(this.centerFeature_),this.circleFeature_&&this.source_.addFeature(this.circleFeature_),this.arcFeatures_&&this.source_.addFeatures(this.arcFeatures_)}setCenterStyle(e){e instanceof a.b?this.centerStyle_=[e]:e instanceof Function||e instanceof Array?this.centerStyle_=e:e instanceof Object&&(this.centerStyle_=[ht(e)])}setCircleStyle(e){e instanceof a.b?this.circleStyle_=[e]:e instanceof Function||e instanceof Array?this.circleStyle_=e:e instanceof Object&&(this.circleStyle_=[ht(e)])}setArcStyle(e){e instanceof a.b?this.arcStyle_=[e]:e instanceof Function||e instanceof Array?this.arcStyle_=e:e instanceof Object&&(this.arcStyle_=[ht(e)])}getCenetr(){return this.center_}getRadius(){return this.radius_}getStartAngle(){return this.startAngle_}getArcAngle(){return this.arcAngle_}getLoop(){return this.loop_}getPeriod(){return this.period_}getSource(){return this.source_}getCenterStyle(){return this.centerStyle_}getCircleStyle(){return this.circleStyle_}getArcStyle(){return this.arcStyle_}getCenterFeature(){return this.centerFeature_}getCircleFeature(){return this.circleFeature_}getArcFeatures(){return this.arcFeatures_}getCurrentAngle(){return this.currentAngle_}}var It=Object.freeze({__proto__:null,ArrowLine:class{constructor(e){Object.defineProperty(this,"coordinates_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arrowStyle_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interval_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timer_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"fraction",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"speed",{enumerable:!0,configurable:!0,writable:!0,value:1});let t=Object.assign({},pt,e);this.source_=t.source,this.coordinates_=t.coordinates,this.interval_=t.interval,this.setArrowStyle(t.arrowStyle),this.setLineStyle(t.lineStyle),this.init_(),this.ready=!0}dispose(){this.end(),this.source_.removeFeature(this.feature_)}init_(){this.feature_?this.feature_.getGeometry().setCoordinates(this.coordinates_):(this.feature_=new _.default({geometry:new y.default(this.coordinates_)}),this.source_.addFeature(this.feature_)),this.feature_.setStyle(this.getStyle_(0))}getStyle_(e){return(t,i)=>{var n=t.getGeometry(),r=n.getLength(),s=this.interval_*i/r;let o=[];this.lineStyle_ instanceof Array?o=o.concat(this.lineStyle_):this.lineStyle_ instanceof Function&&(o=this.lineStyle_({target:this,feature:this.feature_}),o instanceof a.b&&(o=[o]));for(var l=s*e/10;l<=1;l+=s){var h=n.getCoordinateAt(l);n.forEachSegment((e,t)=>{if(e[0]!=t[0]||e[1]!=t[1]){var i=t[0]-h[0],n=t[1]-h[1],r=h[0]-e[0],s=h[1]-e[1];if(Math.abs(1*i*s-1*r*n)<1e-4)if(this.arrowStyle_ instanceof Function){let e=this.arrowStyle_({target:this,feature:this.feature_});e instanceof Array?o.concat(e):o.push(e)}else o.push(_t([e,h],this.arrowStyle_))}})}return o}}start(){this.fraction=0,this.timer_=setInterval(()=>{this.fraction+=this.speed,this.fraction=this.fraction>=10?1:this.fraction;let e=this.fraction;this.feature_.setStyle(this.getStyle_(e))},150)}end(){this.timer_&&(clearInterval(this.timer_),this.timer_=null)}setCoordinates(e){this.coordinates_=e,this.init_()}setLineStyle(e){e instanceof a.b?this.lineStyle_=[e]:e instanceof Function||e instanceof Array?this.lineStyle_=e:e instanceof Object&&(this.lineStyle_=[ht(e)]),this.ready&&this.init_()}setArrowStyle(e){this.arrowStyle_=e,this.ready&&this.init_()}setInterval(e){this.interval_=e,this.ready&&this.init_()}setSource(e){this.source_&&this.feature_&&this.source_.removeFeature(this.feature_),this.source_=e,this.feature_&&e.addFeature(this.feature_)}getLineStyle(){return this.lineStyle_}getInterval(){return this.interval_}},DynamicLine:class{constructor(e){Object.defineProperty(this,"coordinates_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outlineColor_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outlineWidth_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerlineColor_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerlineWidth_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerlineDash_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"innerlineDashOffset_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timer_",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=Object.assign({},gt,e);this.source_=t.source,this.coordinates_=t.coordinates,this.outlineColor_=t.outlineColor,this.outlineWidth_=t.outlineWidth,this.innerlineColor_=t.innerlineColor,this.innerlineWidth_=t.innerlineWidth,this.innerlineDash_=t.innerlineDash,this.innerlineDashOffset_=t.innerlineDashOffset,this.init_()}dispose(){this.end(),this.source_.removeFeature(this.feature_)}init_(){this.feature_?this.feature_.getGeometry().setCoordinates(this.coordinates_):(this.feature_=new _.default({geometry:new y.default(this.coordinates_)}),this.source_.addFeature(this.feature_)),this.feature_.setStyle(this.getStyle_(this.innerlineDashOffset_))}getStyle_(e){return[new a.b({stroke:new h.a({color:this.outlineColor_,width:this.outlineWidth_})}),(()=>new a.b({stroke:new h.a({color:this.innerlineColor_,width:this.innerlineWidth_,lineDash:this.innerlineDash_,lineDashOffset:e})}))()]}start(){let e=this.innerlineDashOffset_;this.timer_=setInterval(()=>{e+=1,this.feature_.setStyle(this.getStyle_(e))},150)}end(){this.timer_&&(clearInterval(this.timer_),this.timer_=null)}setCoordinates(e){this.coordinates_=e,this.init_()}setOutlineColor(e){this.outlineColor_=e,this.init_()}setOutlineWidth(e){this.outlineWidth_=e,this.init_()}setInnerlineColor(e){this.innerlineColor_=e,this.init_()}setInnerlineWidth(e){this.innerlineWidth_=e,this.init_()}setInnerlineDash(e){this.innerlineDash_=e,this.init_()}setInnerlineDashOffset(e){this.innerlineDashOffset_=e,this.init_()}setSource(e){this.source_&&this.feature_&&this.source_.removeFeature(this.feature_),this.source_=e,this.feature_&&e.addFeature(this.feature_)}},Flight:Pt,Scatter:wt,Track:Ft,Radar:St});class Tt extends S.b{constructor(){super(...arguments),Object.defineProperty(this,"coordinate_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"cursor_",{enumerable:!0,configurable:!0,writable:!0,value:"pointer"}),Object.defineProperty(this,"feature_",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"previousCursor_",{enumerable:!0,configurable:!0,writable:!0,value:null})}handleDownEvent(e){var t=e.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));return t&&(this.coordinate_=e.coordinate,this.feature_=t),!!t}handleDragEvent(e){e.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));var t=e.coordinate[0]-this.coordinate_[0],i=e.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(t,i),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1]}handleMoveEvent(e){if(this.cursor_){var t=e.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e})),i=e.map.getTargetElement();t?i.style.cursor!=this.cursor_&&(this.previousCursor_=i.style.cursor,i.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(i.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}}handleUpEvent(e){return this.coordinate_=null,this.feature_=null,!1}}var jt,Mt=Object.freeze({__proto__:null,GeomDrag:Tt}),Lt=Object.freeze({__proto__:null,arrow:ft,parseJSON:ut});function Et(e,t){T.addCoordinateTransforms("EPSG:"+e,"EPSG:"+t,(function(i){return M()("EPSG:"+e,"EPSG:"+t,i)}),(function(i){return M()("EPSG:"+t,"EPSG:"+e,i)}))}!function(e){e.ERROR="error"}(jt||(jt={}));var Ht=jt;class xt extends F.a{constructor(e,t){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=t}}class Rt extends O.a{constructor(e){let t=Object.assign({projection:null,cpg:"UTF-8"},e);super({}),Object.defineProperty(this,"featureCollection_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"projection_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cpg_",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.featureCollection_=new H.a,this.projection_=t.projection,this.cpg_=t.cpg}readFile(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i].name,r=n.lastIndexOf("."),s=n.substring(0,r);"shp"==n.substring(r+1)&&t.push(s)}if(0!=t.length)if(t.length>1)this.dispatchEvent(new xt(Ht.ERROR,"只能上传一个shp文件!"));else for(let i=0;i<t.length;i++){let n=t[i],r="",s="GB2312",o=null,a=null,l=[];for(let t=0;t<e.length;t++){let i=e[t],h=i.name,u=h.lastIndexOf("."),c=h.substring(0,u),d=h.substring(u+1).toLowerCase();c==n&&"cpg"==d&&l.push(new Promise((function(e,t){let n=new FileReader;n.onload=function(t){s=t.target.result,e(t.target.result)},n.readAsText(i)}))),c==n&&"prj"==d&&l.push(new Promise((function(e,t){let n=new FileReader;n.onload=function(t){r=t.target.result.replace("Gauss_Kruger","Transverse_Mercator"),e(t.target.result)},n.readAsText(i)}))),c==n&&"shp"==d&&l.push(new Promise((function(e,t){let n=new FileReader;n.onload=function(t){o=t.target.result,e(t.target.result)},n.readAsArrayBuffer(i)}))),c==n&&"dbf"==d&&l.push(new Promise((function(e,t){let n=new FileReader;n.onload=function(t){a=t.target.result,e(t.target.result)},n.readAsArrayBuffer(i)})))}Promise.all(l).then(function(e){if(!r)return void this.dispatchEvent({type:"error",message:"无法识别的坐标系!"});M.a.defs("EPSG:9999",r);let t=new L.a({code:"EPSG:9999"});var i,n;T.addProjection(t),Et("4326","9999"),Et("3857","9999"),i=this.projection_.getCode(),n="EPSG:9999",T.addCoordinateTransforms(i,n,(function(e){return M()(i,n,e)}),(function(e){return M()(n,i,e)})),E.open(o,a,{encoding:s}).then(function(e){e.read().then(function t(i){if(i.done)return void this.dispatchEvent({type:"loaded"});for(let e in i.value.properties){let t=i.value.properties[e];if("string"==typeof t){for(;t.indexOf("\0")>-1;)t=t.replace("\0","");i.value.properties[e]=t}}let n=(new I.a).readFeature(i.value,{featureProjection:T.get(this.projection_.getCode()),dataProjection:T.get("EPSG:9999")});return this.featureCollection_.push(n),e.read().then(t.bind(this))}.bind(this))}.bind(this)).catch(e=>console.error(e.stack))}.bind(this)).catch((function(e){console.error(e)}))}else this.dispatchEvent(new xt(Ht.ERROR,"不存在shp文件!"))}readVector(e){let t=e.getSource().getFeatures();this.setFeatures(t)}downLoadZip(e){let t=this.getFeatures(),i=(new I.a).writeFeatures(t);var n=new D.a,r=n.folder(e&&e.folder?e.folder:"layers"),s=new x.GeoJson2Shp(i);s.writePoint(function(e,t){r.file("point.shp",t.shp.buffer,{binary:!0}),r.file("point.shx",t.shx.buffer,{binary:!0}),r.file("point.dbf",t.dbf.buffer,{binary:!0}),r.file("point.prj",this.getProjectionWKT()),r.file("point.cpg",this.cpg_)}.bind(this)),s.writePolyline(function(e,t){r.file("polyline.shp",t.shp.buffer,{binary:!0}),r.file("polyline.shx",t.shx.buffer,{binary:!0}),r.file("polyline.dbf",t.dbf.buffer,{binary:!0}),r.file("polyline.prj",this.getProjectionWKT()),r.file("polyline.cpg",this.cpg_)}.bind(this)),s.writePolygon(function(e,t){r.file("polygon.shp",t.shp.buffer,{binary:!0}),r.file("polygon.shx",t.shx.buffer,{binary:!0}),r.file("polygon.dbf",t.dbf.buffer,{binary:!0}),r.file("polygon.prj",this.getProjectionWKT()),r.file("polygon.cpg",this.cpg_)}.bind(this));var o=e&&e.name?e.name:"example";n.generateAsync({type:"blob"}).then((function(t){Object(R.saveAs)(t,o+".zip"),e.successCallback&&e.successCallback instanceof Function&&e.successCallback()}))}getFeatures(){return this.featureCollection_.getArray()}setFeatures(e){this.featureCollection_.clear(),this.featureCollection_.extend(e)}getProjectionWKT(){if("EPSG:4490"==this.projection_.getCode())return'GEOGCS["GCS_China_Geodetic_Coordinate_System_2000",DATUM["D_China_2000",SPHEROID["CGCS2000",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]';if("EPSG:4326"==this.projection_.getCode())return'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433],AUTHORITY["EPSG",4326]]';throw"无法识别坐标系:"+this.projection_.getCode()}}},399:function(module,exports,__webpack_require__){"use strict";function extendCoordinate(e,t){return t[0]<e.xmin&&(e.xmin=t[0]),t[0]>e.xmax&&(e.xmax=t[0]),t[1]<e.ymin&&(e.ymin=t[1]),t[1]>e.ymax&&(e.ymax=t[1]),e}function createEmpty(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}}__webpack_require__(91),__webpack_require__(96),__webpack_require__(400),__webpack_require__(404),__webpack_require__(407),__webpack_require__(410),Object.defineProperty(exports,"__esModule",{value:!0});class Writer$1{constructor(e,t){this.geometries_=e,this.type_=t}write(e){var t=100+this.getShpLength(),i=100+this.getShxLength(),n=new ArrayBuffer(t),r=new DataView(n),s=new ArrayBuffer(i),o=new DataView(s),a=this.getExtent();this.writeHeader(r,this.type_),this.writeHeader(o,this.type_),this.writeExtent(a,r),this.writeExtent(a,o),this.writeGeometry(new DataView(n),new DataView(s)),r.setInt32(24,t/2),o.setInt32(24,i/2),e(null,{shp:r,shx:o})}writeHeader(e){e.setInt32(0,9994),e.setInt32(28,1e3,!0),e.setInt32(32,this.type_,!0)}writeExtent(e,t){t.setFloat64(36,e.xmin,!0),t.setFloat64(44,e.ymin,!0),t.setFloat64(52,e.xmax,!0),t.setFloat64(60,e.ymax,!0)}writeGeometry(e,t){}getShpLength(){}getShxLength(){}getExtent(){}getPartCount(e){}getFlattened(e,t){return void 0===t&&(t=[]),"object"==typeof e[0][0]?e.reduce(function(e,t){return e.concat(this.getFlattened(t))}.bind(this),t):e}}class MultiPointWriter extends Writer$1{constructor(e,t){super(e,t)}writeGeometry(e,t){var i,n=100,r=100;this.geometries_.forEach(function(s,o){var a=this.getFlattened(s);i=40+16*a.length;var l=a.reduce((function(e,t){return extendCoordinate(e,t)}),createEmpty());t.setInt32(r,n/2),t.setInt32(r+4,i/2),r+=8,e.setInt32(n,o+1),e.setInt32(n+4,i/2),e.setInt32(n+8,this.type_,!0),e.setFloat64(n+12,l.xmin,!0),e.setFloat64(n+20,l.ymin,!0),e.setFloat64(n+28,l.xmax,!0),e.setFloat64(n+36,l.ymax,!0),e.setInt32(n+44,a.length,!0),a.forEach((function(t,i){e.setFloat64(n+48+16*i,t[0],!0),e.setFloat64(n+48+16*i+8,t[1],!0)})),n+=i+8}.bind(this))}getPartCount(e){return e.length}getExtent(){return this.getFlattened(this.geometries_).reduce((function(e,t){return extendCoordinate(e,t)}),createEmpty())}getShxLength(){return 8*this.geometries_.length}getShpLength(){return 48*this.geometries_.length+16*this.getFlattened(this.geometries_).length}}class PointWriter extends Writer$1{constructor(e,t){super(e,t)}writeGeometry(e,t){var i=100,n=100;this.geometries_.forEach(function(r,s){t.setInt32(n,i/2),t.setInt32(n+4,10),n+=8,e.setInt32(i,s+1),e.setInt32(i+4,10),e.setInt32(i+8,this.type_,!0),e.setFloat64(i+12,r[0],!0),e.setFloat64(i+20,r[1],!0),i+=28}.bind(this))}getPartCount(e){return e.length}getExtent(){return this.geometries_.reduce((function(e,t){return extendCoordinate(e,t)}),createEmpty())}getShpLength(){return 28*this.geometries_.length}getShxLength(){return 8*this.geometries_.length}}class PolyWriter extends Writer$1{constructor(e,t){super(e,t)}writeGeometry(e,t){var i,n=100,r=100;this.geometries_.forEach(function(s,o){var a=this.getFlattened(s),l=this.getPartCount([s],this.type_);i=44+4*l+16*a.length;var h=a.reduce((function(e,t){return extendCoordinate(e,t)}),createEmpty());t.setInt32(r,n/2),t.setInt32(r+4,i/2),r+=8,e.setInt32(n,o+1),e.setInt32(n+4,i/2),e.setInt32(n+8,this.type_,!0),e.setFloat64(n+12,h.xmin,!0),e.setFloat64(n+20,h.ymin,!0),e.setFloat64(n+28,h.xmax,!0),e.setFloat64(n+36,h.ymax,!0),e.setInt32(n+44,l,!0),e.setInt32(n+48,a.length,!0),e.setInt32(n+52,0,!0);for(var u=s.reduce((function(e,t){return Array.isArray(t[0][0])?e=e.concat(t):e.push(t),e}),[]),c=1;c<l;c++)e.setInt32(n+52+4*c,u.reduce((function(e,t,i){return i<c?e+t.length:e}),0),!0);a.forEach((function(t,i){e.setFloat64(n+56+16*i+4*(l-1),t[0],!0),e.setFloat64(n+56+16*i+4*(l-1)+8,t[1],!0)})),n+=i+8}.bind(this))}getPartCount(e){return e.reduce((function(e,t){return e+=t.length,Array.isArray(t[0][0][0])&&(e+=t.reduce((function(e,t){return e+t.length-1}),0)),e}),0)}getExtent(){return this.getFlattened(this.geometries_).reduce((function(e,t){return extendCoordinate(e,t)}),createEmpty())}getShpLength(){return 52*this.geometries_.length+4*this.getPartCount(this.geometries_)+16*this.getFlattened(this.geometries_).length}getShxLength(){return 8*this.geometries_.length}}function lpad(e,t,i){for(;e.length<t;)e=i+e;return e}function rpad(e,t,i){for(;e.length<t;)e+=i;return e}function stringToUint8Array(e,t={stream:!1}){if(t.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let i=0;const n=e.length;let r=0,s=Math.max(32,n+(n>>1)+7),o=new Uint8Array(s>>3<<3);for(;i<n;){let t=e.charCodeAt(i++);if(t>=55296&&t<=56319){if(i<n){const n=e.charCodeAt(i);56320==(64512&n)&&(++i,t=((1023&t)<<10)+(1023&n)+65536)}if(t>=55296&&t<=56319)continue}if(r+4>o.length){s+=8,s*=1+i/e.length*2,s=s>>3<<3;const t=new Uint8Array(s);t.set(o),o=t}if(0!=(4294967168&t)){if(0==(4294965248&t))o[r++]=t>>6&31|192;else if(0==(4294901760&t))o[r++]=t>>12&15|224,o[r++]=t>>6&63|128;else{if(0!=(4292870144&t))continue;o[r++]=t>>18&7|240,o[r++]=t>>12&63|128,o[r++]=t>>6&63|128}o[r++]=63&t|128}else o[r++]=t}return o.slice(0,r)}const FieldSize={C:254,L:1,D:8,N:18,M:18,F:18,B:8};var FieldType={string:"C",number:"N",boolean:"L",null:"C"};function multi(e){var t={};return e.forEach((function(e){inherit(t,e)})),obj(t)}function inherit(e,t){for(var i in t){var n=void 0!==t[i]&&null!==t[i];(void 0===e[i]||n)&&(e[i]=t[i])}return e}function obj(e){var t={},i=[];for(var n in e)t[n]=null===e[n]?"null":typeof e[n];for(var r in t){var s=FieldType[t[r]];s&&i.push({name:r,type:s,size:FieldSize[s]})}return i}class Writer{constructor(e,t){this.field_meta_=t||multi(e),this.data_=e}write(e){var t=32*this.field_meta_.length,i=this.getBytesPerRecord(this.field_meta_),n=new ArrayBuffer(32+t+1+i*this.data_.length+1),r=new Date,s=new DataView(n);s.setUint8(0,3),s.setUint8(1,r.getFullYear()-1900),s.setUint8(2,r.getMonth()),s.setUint8(3,r.getDate()),s.setUint32(4,this.data_.length,!0);var o=t+32+1;s.setUint16(8,o,!0),s.setUint16(10,i,!0),s.setInt8(32+t,13),this.field_meta_.forEach((function(e,t){let i=e.name.slice(0,10);i=rpad(i,10," ");let n=stringToUint8Array(i);for(let e=0;e<10;e++)s.setInt8(32+32*t+e,n[e]);s.setInt8(32+32*t+11,e.type.charCodeAt(0)),s.setInt8(32+32*t+16,e.size),"N"==e.type&&s.setInt8(32+32*t+17,3)}));var a=t+32+1;this.data_.forEach(function(e,t){s.setUint8(a,32),a++,this.field_meta_.forEach(function(t){var i=e[t.name];switch(null==i&&(i=""),t.type){case"L":s.setUint8(a,i?84:70),a++;break;case"D":a=this.writeField_(s,8,lpad(i.toString(),8," "),a);break;case"N":a=this.writeField_(s,t.size,lpad(i.toString(),t.size," ").substr(0,18),a);break;case"C":a=this.writeField_(s,t.size,rpad(i.toString(),t.size," "),a);break;default:throw new Error("Unknown field type")}}.bind(this))}.bind(this)),s.setUint8(a,26),e(null,{dbf:s})}writeField_(e,t,i,n){let r=stringToUint8Array(i);for(var s=0;s<t;s++)e.setUint8(n,r[s]),n++;return n}getBytesPerRecord(e){return e.reduce((function(e,t){return e+t.size}),1)}}var geometryType={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31};class GeoJson2Shp{constructor(geojson){"string"==typeof geojson&&(geojson=eval("("+geojson+")")),this.geojson_=geojson}writePoint(e){this.write_(geometryType.POINT,e)}writeMultiPoint(e){this.write_(geometryType.MULTIPOINT,e)}writePolyline(e){this.write_(geometryType.POLYLINE,e)}writePolygon(e){this.write_(geometryType.POLYGON,e)}write_(e,t){var i=this.getWriteOptions_(e),n=this.getShpWriter_(e);i&&new n(i.geometries,i.type).write((function(e,n){new Writer(i.properties).write((function(e,i){n.dbf=i.dbf,t(e,n)}))}))}getShpWriter_(e){var t;return e==geometryType.POINT?t=PointWriter:e==geometryType.MULTIPOINT?t=MultiPointWriter:(e==geometryType.POLYLINE||e==geometryType.POLYGON)&&(t=PolyWriter),t}getPointOptions_(){var e=this.geojson_.features.filter((function(e){return"Point"===e.geometry.type}));return e&&0!=e.length?{geometries:e.map(this.justCoords_),properties:e.map(this.justProps_),type:geometryType.POINT}:null}getMultiPointOptions_(){var e=this.geojson_.features.filter((function(e){return"MultiPoint"===e.geometry.type}));return e&&0!=e.length?{geometries:e.map(this.justCoords_),properties:e.map(this.justProps_),type:geometryType.MULTIPOINT}:null}getPolylineOptions_(){var e=this.geojson_.features.filter((function(e){return"LineString"===e.geometry.type||"MultiLineString"===e.geometry.type}));return e&&0!=e.length?{geometries:e.map(this.justCoords_),properties:e.map(this.justProps_),type:geometryType.POLYLINE}:null}getPolygonOptions_(){var e=this.geojson_.features.filter((function(e){return"Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type}));return e&&0!=e.length?{geometries:e.map(this.justCoords_),properties:e.map(this.justProps_),type:geometryType.POLYGON}:null}getWriteOptions_(e){var t;return e==geometryType.POINT?t=this.getPointOptions_():e==geometryType.MULTIPOINT?t=this.getMultiPointOptions_():e==geometryType.POLYLINE?t=this.getPolylineOptions_():e==geometryType.POLYGON&&(t=this.getPolygonOptions_()),t}justCoords_(e){return"LineString"==e.geometry.type||"MultiLineString"==e.geometry.type?[e.geometry.coordinates]:e.geometry.coordinates}justProps_(e){return e.properties}}exports.GeoJson2Shp=GeoJson2Shp}}]);